(function($){function sortItems(form_id,$list){var items=$("li",$list);items.sort(function(a,b){if($(b).find("#select_all").length>0){return 1}a=$(a).hasClass("active");b=$(b).hasClass("active");return a===b?0:a<b?1:-1});$list.append(items);$list.sortable("refresh");storeOrder(form_id,$list)}function storeOrder(form_id,$list){if(ajaxurl===undefined){return}$.post(ajaxurl,{action:"gf-sort-export-store-order",form_id:form_id,order:$list.sortable("toArray",{attribute:"rel"})})}function setListOrder(form_id,$list){if(ajaxurl===undefined){return}$.get(ajaxurl,{action:"gf-sort-export-get-order",form_id:form_id,dataType:"json"},function(order){if(order.length===0){return}var $items=$("li",$list);$items.find("input[type=checkbox]").each(function(){if(order.includes($(this).val())){$(this).attr("checked",true).trigger("change",true)}});$items.sort(function(a,b){if($(b).find("#select_all").length>0){return 1}a=order.indexOf($(a).attr("rel"));b=order.indexOf($(b).attr("rel"));if(a===b){return 0}if(a===-1||b===-1){return a===-1?1:-1}return a<b?-1:1});$list.append($items)})}$(function(){var $list=$("#export_field_list"),$export_form=$("#export_form"),updating=false,timeout;$export_form.on("change",function(){updating=true});$list.on("DOMSubtreeModified",function(){if(!updating){return}if($list.find("li").length>0){updating=false;setListOrder($export_form.val(),$list)}});$list.sortable({items:"> li:not(:first-child).active",cancel:"> li:not(.active)",update:function(){storeOrder($export_form.val(),$list)}}).on("change","input[type=checkbox]",function(e,is_propagated){$parent=$(this).parent("li");$parent.toggleClass("active",$(this).is(":checked"));$parent.attr("rel",$(this).is(":checked")?$(this).val():null);if($(this).attr("id")==="select_all"){$list.find("input.gform_export_field").trigger("change",true)}if(!is_propagated){clearTimeout(timeout);timeout=setTimeout(function(){sortItems($export_form.val(),$list)},1250)}})})})(jQuery);